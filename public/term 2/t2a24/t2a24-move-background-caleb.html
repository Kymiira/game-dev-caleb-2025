<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mario-Style Game</title>
<style>
    body { 
        margin: 0; 
        overflow: hidden; 
        background-image: url('../t2a25/BackgroundImg.png'); 
        background-repeat: repeat-x; 
        background-attachment: fixed;
        background-color: #87ceeb;
        background-size: auto 100%; 
    }
    #gameContainer { 
        position: relative; 
        width: 800px; 
        height: 500px; 
        margin: auto; 
        overflow: hidden; 
        border: 4px solid #333;
        background: rgba(135, 206, 235, 0.5);
    }
    img { position: absolute; }
    #ui { 
        position: absolute; 
        top: 0; 
        left: 0; 
        padding: 10px; 
        color: #fff; 
        font-family: sans-serif; 
        font-weight: bold;
        text-shadow: 2px 2px #000;
        z-index: 1000; 
    }
    #message { 
        position: absolute; 
        top: 200px; 
        left: 50%; 
        transform: translateX(-50%); 
        font-size: 24px; 
        color: #fff; 
        background: rgba(0,0,0,0.8); 
        padding: 15px 30px; 
        border-radius: 10px; 
        display: none; 
        z-index: 1001; 
    }
</style>
</head>
<body id="myBody">

<div id="gameContainer">
  <div id="ui">Lives: 3 | Score: 0</div>
  <div id="message"></div>

  <img id="player" src="../t2a25/MoveImg.png" style="width:50px; height:50px; top:300px; left:50px;">
  <img id="hazard1" src="../t2a25/StillImg.png" style="width:50px; height:50px; top:350px; left:300px;">
  <img id="hazard2" src="../t2a25/StillImg.png" style="width:50px; height:50px; top:350px; left:500px;">
  <img id="ground" src="../t2a25/GroundImg.png" style="width:2000px; height:50px; top:450px; left:0;">
  <img id="platform1" src="../t2a25/GroundImg.png" style="width:100px; height:20px; top:350px; left:200px;">
  <img id="platform2" src="../t2a25/GroundImg.png" style="width:100px; height:20px; top:300px; left:400px;">
  <img id="platform3" src="../t2a25/GroundImg.png" style="width:100px; height:20px; top:250px; left:600px;">
  <img id="goal" src="https://placehold.co/50x50/00FF00/FFFFFF?text=FLAG" style="width:50px; height:50px; top:350px; left:1800px;">
</div>

<script>
class GameObject {
    constructor(id, x, y, width, height) {
        this.id = id;
        this.el = document.getElementById(id);
        this.x = x; this.y = y;
        this.width = width; this.height = height;
        this.vx = 0; this.vy = 0;
        this.updatePosition();
    }
    updatePosition() { 
        this.el.style.left = this.x + 'px'; 
        this.el.style.top = this.y + 'px'; 
    }
    collidesWith(other) { 
        return !(this.x + this.width <= other.x || 
                 this.x >= other.x + other.width || 
                 this.y + this.height <= other.y || 
                 this.y >= other.y + other.height); 
    }
}

class Player extends GameObject {
    constructor(id, x, y, width, height) { super(id,x,y,width,height); this.onGround=false; }
    move() { this.x += this.vx; this.y += this.vy; }
}

class Hazard extends GameObject {
    constructor(id, x, y, width, height) { super(id,x,y,width,height); this.vx=1.5; }
    move() { this.x += this.vx; this.y += this.vy; }
}

class Ground extends GameObject {}
class Platform extends GameObject {}
class Goal extends GameObject {}

const player = new Player('player',50,300,50,50);
const hazards = [
    new Hazard('hazard1',300,350,50,50),
    new Hazard('hazard2',500,350,50,50)
];
const grounds = [ new Ground('ground',0,450,2000,50) ];
const platforms = [
    new Platform('platform1',200,350,100,20),
    new Platform('platform2',400,300,100,20),
    new Platform('platform3',600,250,100,20)
];
const goal = new Goal('goal',1800,350,50,50);

const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()]=false);

const gravity=0.8, moveSpeed=5, jumpPower=-15;
const messageDiv = document.getElementById('message');

function showMessage(text, duration=1500){
    messageDiv.innerText = text;
    messageDiv.style.display = 'block';
    setTimeout(()=>{ messageDiv.style.display='none'; }, duration);
}

function checkCollision(obj) {
    obj.onGround=false;
    const targets = grounds.concat(platforms);
    for(let p of targets){
        if(obj.y + obj.height <= p.y &&
           obj.y + obj.height + obj.vy >= p.y &&
           obj.x + obj.width > p.x &&
           obj.x < p.x + p.width){
            obj.y = p.y - obj.height;
            obj.vy = 0;
            obj.onGround = true;
        }
    }
}

function updateHazards(){
    for(let h of hazards){
        h.vy += gravity;
        checkCollision(h);
        h.move();
        if(h.x <= 0 || h.x >= 1950) h.vx *= -1;
        h.updatePosition();
    }
}

function gameLoop(){
    player.vx=0;
    if(keys['a'] || keys['arrowleft']) player.vx=-moveSpeed;
    if(keys['d'] || keys['arrowright']) player.vx=moveSpeed;
    if((keys['w'] || keys[' ']) && player.onGround) player.vy=jumpPower;

    player.vy += gravity;
    checkCollision(player);
    player.move();

    updateHazards();
    
    for(let h of hazards){
        if(player.collidesWith(h)){
            showMessage('Oops! Try Again.');
            player.x = 50; player.y = 300;
        }
    }

    if(player.collidesWith(goal)){
        showMessage('LEVEL COMPLETE!', 3000);
        player.vx = 0; player.vy = 0;
        return;
    }

    const offset = Math.max(player.x - 400, 0);

    [...hazards, ...platforms, ...grounds, goal].forEach(obj => { 
        obj.el.style.left = (obj.x - offset) + 'px'; 
    });

    player.el.style.left = (player.x < 400) ? player.x + 'px' : '400px';
    player.el.style.top = player.y + 'px';

    let bgPos = -(offset * 0.5);
    document.body.style.backgroundPosition = bgPos + "px 0px";

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>