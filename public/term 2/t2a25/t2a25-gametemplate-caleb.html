<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gravity Game</title>
</head>

<body id="myBody"
      style="background-image:url('BackgroundImg.png');
             background-repeat:repeat; background-size:80%;
             margin:0; overflow:hidden; height:100vh;">

<h1 align="center">Gravity + Classes</h1>

<script>
class CollisionBlock {
    constructor(id, x, y, w, h, img) {
        this.el = document.createElement("img")
        this.el.id = id
        this.el.src = img
        this.el.style.position = "absolute"
        this.el.style.left = x + "px"
        this.el.style.top = y + "px"
        this.el.style.width = w + "px"
        this.el.style.height = h + "px"
        document.body.appendChild(this.el)
    }

    get left()   { return parseInt(this.el.style.left) }
    get top()    { return parseInt(this.el.style.top) }
    get right()  { return this.left + parseInt(this.el.style.width) }
    get bottom() { return this.top + parseInt(this.el.style.height) }

    hit(other) {
        return !(this.right < other.left ||
                 this.left > other.right ||
                 this.bottom < other.top ||
                 this.top > other.bottom)
    }
}

class Player extends CollisionBlock {
    constructor(id, x, y, w, h, img) {
        super(id, x, y, w, h, img)
        this.vx = 0
        this.vy = 0
        this.speed = 6
        this.jumpPower = 18
        this.gravity = 1
        this.onGround = false
    }

    applyPhysics() {
        this.vy += this.gravity

        this.el.style.left = this.left + this.vx + "px"
        this.el.style.top  = this.top + this.vy + "px"

        if (this.vx !== 0) {
            bgX -= this.vx
            document.getElementById("myBody").style.backgroundPosition =
                bgX + "px " + bgY + "px"
        }
    }

    jump() {
        if (this.onGround) {
            this.vy = -this.jumpPower
            this.onGround = false
        }
    }
}

class Hazard extends CollisionBlock {}
class Ground extends CollisionBlock {}

let keys = {}
let bgX = 0
let bgY = 0

document.addEventListener("keydown", e => keys[e.key] = true)
document.addEventListener("keyup", e => keys[e.key] = false)

let player = new Player("player", 100, 0, 80, 80,
    "MoveImg.png")

let ground = new Ground("ground", 0, 400, 2000, 100,
    "GroundImg.png")

let hazard = new Hazard("haz", 500, 330, 80, 80,
    "StillImg.png")

function gameLoop() {
    player.vx = 0

    if (keys["a"] || keys["A"]) player.vx = -player.speed
    if (keys["d"] || keys["D"]) player.vx = player.speed
    if (keys["w"] || keys["W"]) player.jump()

    player.applyPhysics()

    player.onGround = false
    if (player.hit(ground)) {
        player.el.style.top = ground.top - parseInt(player.el.style.height) + "px"
        player.vy = 0
        player.onGround = true
    }

    if (player.hit(hazard)) {
        alert("you lose")
        location = "../../index.html"
    }

    requestAnimationFrame(gameLoop)
}

gameLoop()
</script>

</body>
</html>
